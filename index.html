<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shins Bulletin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Left Panel - Apps */
        .left-panel {
            width: 350px;
            padding: 40px 30px;
            background: rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 40px;
        }

        .apps-section h2 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #888;
            margin-bottom: 20px;
        }

        .app-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
        }

        .app-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            border: 1px solid transparent;
        }

        .app-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(8px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .app-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .app-icon.translator {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .app-icon.vocabulary {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        }

        .app-icon.todo {
            background: linear-gradient(135deg, #2ecc71 0%, #1a8f4a 100%);
        }

        .app-info h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .app-info p {
            font-size: 0.8rem;
            color: #888;
        }

        /* Right Panel - Info */
        .right-panel {
            flex: 1;
            padding: 40px 50px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Date & Time */
        .datetime-section {
            text-align: right;
        }

        .current-time {
            font-size: 4rem;
            font-weight: 700;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #fff 0%, #ccc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .current-date {
            font-size: 1.3rem;
            color: #888;
            margin-top: 5px;
        }

        /* Weather */
        .weather-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .weather-icon {
            font-size: 4rem;
        }

        .weather-info h3 {
            font-size: 2.5rem;
            font-weight: 600;
        }

        .weather-info p {
            color: #888;
            font-size: 1rem;
        }

        .weather-details {
            margin-left: auto;
            text-align: right;
        }

        .weather-details div {
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .weather-details span {
            color: #fff;
            font-weight: 500;
        }

        /* Calendar */
        .calendar-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
        }

        .calendar-section h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .calendar-embed {
            border-radius: 12px;
            overflow: hidden;
            background: #fff;
        }

        .calendar-embed iframe {
            width: 100%;
            height: 300px;
            border: none;
        }

        /* Reminder */
        .reminder-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
        }

        .reminder-section h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reminder-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid;
        }

        .reminder-item.buy {
            border-color: #ff9800;
        }

        .reminder-item.todo {
            border-color: #3498db;
        }

        .reminder-item.remember {
            border-color: #ff69b4;
        }

        .reminder-item .tag {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .reminder-item.buy .tag {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .reminder-item.todo .tag {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .reminder-item.remember .tag {
            background: rgba(255, 105, 180, 0.2);
            color: #ff69b4;
        }

        .reminder-item .text {
            flex: 1;
        }

        .reminder-item .owner {
            font-size: 1.2rem;
        }

        .empty-reminder {
            text-align: center;
            color: #666;
            padding: 40px;
        }

        /* News Section */
        .news-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
        }

        .news-section h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .news-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .news-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .news-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .news-item img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .news-content h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 5px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-content p {
            font-size: 0.8rem;
            color: #888;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-empty {
            text-align: center;
            color: #666;
            padding: 30px;
        }

        /* Greeting */
        .greeting {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .greeting-name {
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: #555;
            font-size: 0.8rem;
            padding: 20px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .left-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .app-list {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .app-card {
                flex: 1;
                min-width: 200px;
            }

            .current-time {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel - Apps -->
        <div class="left-panel">
            <div class="logo">Shins Bulletin</div>
            <div class="logo-subtitle">Family Dashboard</div>

            <div class="apps-section">
                <h2>Apps</h2>
                <div class="app-list">
                    <a href="https://shinsfamily-vibe.github.io/shins-translator/" target="_blank" class="app-card">
                        <div class="app-icon translator">üåê</div>
                        <div class="app-info">
                            <h3>Translator</h3>
                            <p>Korean ‚Üî English</p>
                        </div>
                    </a>

                    <a href="https://shinsfamily-vibe.github.io/shins-vocabulary/Shins_vocabulary.html" target="_blank" class="app-card">
                        <div class="app-icon vocabulary">üìö</div>
                        <div class="app-info">
                            <h3>Vocabulary</h3>
                            <p>Family Word Book</p>
                        </div>
                    </a>

                    <a href="https://shinsfamily-vibe.github.io/shins-todo/" target="_blank" class="app-card">
                        <div class="app-icon todo">‚úÖ</div>
                        <div class="app-info">
                            <h3>Family Todo</h3>
                            <p>Shared Memo & Tasks</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Right Panel - Info -->
        <div class="right-panel">
            <!-- Greeting & DateTime -->
            <div class="datetime-section">
                <div class="greeting">
                    <span id="greetingText">Good morning</span>, <span class="greeting-name">Shins Family</span>
                </div>
                <div class="current-time" id="currentTime">00:00</div>
                <div class="current-date" id="currentDate">Loading...</div>
            </div>

            <!-- Weather -->
            <div class="weather-section">
                <div class="weather-icon" id="weatherIcon">üå§Ô∏è</div>
                <div class="weather-info">
                    <h3 id="temperature">--¬∞C</h3>
                    <p id="weatherDesc">Loading weather...</p>
                </div>
                <div class="weather-details">
                    <div>Humidity: <span id="humidity">--%</span></div>
                    <div>Wind: <span id="wind">-- m/s</span></div>
                    <div>Location: <span id="location">--</span></div>
                </div>
            </div>

            <!-- Google Calendar -->
            <div class="calendar-section">
                <h2>üìÖ Today's Schedule</h2>
                <div class="calendar-embed">
                    <iframe id="calendarFrame" src="" frameborder="0"></iframe>
                </div>
                <p style="font-size: 0.8rem; color: #666; margin-top: 10px; text-align: center;">
                    <a href="#" onclick="promptCalendarId()" style="color: #667eea;">Set your Google Calendar</a>
                </p>
            </div>

            <!-- Reminders -->
            <div class="reminder-section">
                <h2>üìå Today's Reminders</h2>
                <div class="reminder-list" id="reminderList">
                    <div class="empty-reminder">Loading reminders...</div>
                </div>
            </div>

            <!-- NYT News -->
            <div class="news-section">
                <h2>üì∞ NYT Top Stories</h2>
                <div class="news-list" id="newsList">
                    <div class="news-empty">Loading news...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update time
        function updateDateTime() {
            const now = new Date();

            // Time
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}`;

            // Date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);

            // Greeting
            const hour = now.getHours();
            let greeting = 'Good evening';
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 18) greeting = 'Good afternoon';
            document.getElementById('greetingText').textContent = greeting;
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Weather (using Open-Meteo free API)
        async function fetchWeather() {
            try {
                // Get location (default: Winchester, MA)
                let lat = 42.4523;
                let lon = -71.1370;
                let locationName = 'Winchester, MA';

                // Try to get user's location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            lat = position.coords.latitude;
                            lon = position.coords.longitude;
                            await getWeatherData(lat, lon, 'Current Location');
                        },
                        async () => {
                            await getWeatherData(lat, lon, locationName);
                        }
                    );
                } else {
                    await getWeatherData(lat, lon, locationName);
                }
            } catch (e) {
                console.error('Weather error:', e);
            }
        }

        async function getWeatherData(lat, lon, locationName) {
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=auto`
                );
                const data = await response.json();

                const current = data.current;
                const temp = Math.round(current.temperature_2m);
                const humidity = current.relative_humidity_2m;
                const wind = current.wind_speed_10m;
                const weatherCode = current.weather_code;

                document.getElementById('temperature').textContent = `${temp}¬∞C`;
                document.getElementById('humidity').textContent = `${humidity}%`;
                document.getElementById('wind').textContent = `${wind} m/s`;
                document.getElementById('location').textContent = locationName;

                // Weather icon and description based on WMO code
                const weatherInfo = getWeatherInfo(weatherCode);
                document.getElementById('weatherIcon').textContent = weatherInfo.icon;
                document.getElementById('weatherDesc').textContent = weatherInfo.desc;
            } catch (e) {
                document.getElementById('weatherDesc').textContent = 'Weather unavailable';
            }
        }

        function getWeatherInfo(code) {
            const weatherMap = {
                0: { icon: '‚òÄÔ∏è', desc: 'Clear sky' },
                1: { icon: 'üå§Ô∏è', desc: 'Mainly clear' },
                2: { icon: '‚õÖ', desc: 'Partly cloudy' },
                3: { icon: '‚òÅÔ∏è', desc: 'Overcast' },
                45: { icon: 'üå´Ô∏è', desc: 'Foggy' },
                48: { icon: 'üå´Ô∏è', desc: 'Depositing rime fog' },
                51: { icon: 'üåßÔ∏è', desc: 'Light drizzle' },
                53: { icon: 'üåßÔ∏è', desc: 'Moderate drizzle' },
                55: { icon: 'üåßÔ∏è', desc: 'Dense drizzle' },
                61: { icon: 'üåßÔ∏è', desc: 'Slight rain' },
                63: { icon: 'üåßÔ∏è', desc: 'Moderate rain' },
                65: { icon: 'üåßÔ∏è', desc: 'Heavy rain' },
                71: { icon: 'üå®Ô∏è', desc: 'Slight snow' },
                73: { icon: 'üå®Ô∏è', desc: 'Moderate snow' },
                75: { icon: '‚ùÑÔ∏è', desc: 'Heavy snow' },
                77: { icon: 'üå®Ô∏è', desc: 'Snow grains' },
                80: { icon: 'üå¶Ô∏è', desc: 'Slight rain showers' },
                81: { icon: 'üå¶Ô∏è', desc: 'Moderate rain showers' },
                82: { icon: '‚õàÔ∏è', desc: 'Violent rain showers' },
                95: { icon: '‚õàÔ∏è', desc: 'Thunderstorm' },
                96: { icon: '‚õàÔ∏è', desc: 'Thunderstorm with hail' },
                99: { icon: '‚õàÔ∏è', desc: 'Thunderstorm with heavy hail' }
            };
            return weatherMap[code] || { icon: 'üå°Ô∏è', desc: 'Unknown' };
        }

        fetchWeather();

        // Reminders from Google Sheets (same as todo app)
        const SPREADSHEET_ID = '18M12tKJ-GYj2MefV0R1pMmyDlJlewDU-Aui99kwdJmc';

        async function loadReminders() {
            try {
                // Try to load from public Google Sheets (read-only)
                const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;
                const response = await fetch(url);
                const text = await response.text();

                // Parse the JSONP-like response
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;

                const reminders = [];
                const userIcons = { dad: 'üëî', mom: 'üë©‚Äçüç≥', son: 'üéí' };
                const tagNames = { buy: 'ÏÇ¥ Í≤É', todo: 'Ìï¥ÏïºÌï† Í≤É', remember: 'Í∏∞ÏñµÌï† Í≤É' };

                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i].c;
                    if (!row[0]) continue;

                    const completed = row[3]?.v === 'true';
                    if (completed) continue; // Skip completed items

                    reminders.push({
                        text: row[1]?.v || '',
                        tag: row[2]?.v || 'todo',
                        owner: row[5]?.v || 'dad'
                    });
                }

                renderReminders(reminders.slice(0, 5), userIcons, tagNames);
            } catch (e) {
                console.error('Error loading reminders:', e);
                document.getElementById('reminderList').innerHTML =
                    '<div class="empty-reminder">Todo Ïï±Ïóê Î°úÍ∑∏Ïù∏ÌïòÎ©¥ Î¶¨ÎßàÏù∏ÎçîÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.</div>';
            }
        }

        function renderReminders(reminders, userIcons, tagNames) {
            const list = document.getElementById('reminderList');

            if (reminders.length === 0) {
                list.innerHTML = '<div class="empty-reminder">No pending tasks! üéâ</div>';
                return;
            }

            list.innerHTML = reminders.map(r => `
                <div class="reminder-item ${r.tag}">
                    <span class="tag">${tagNames[r.tag] || r.tag}</span>
                    <span class="text">${r.text}</span>
                    <span class="owner">${userIcons[r.owner] || 'üë§'}</span>
                </div>
            `).join('');
        }

        loadReminders();

        // Google Calendar
        function loadCalendar() {
            const savedCalendarId = localStorage.getItem('shins_calendar_id');
            if (savedCalendarId) {
                setCalendarEmbed(savedCalendarId);
            } else {
                document.getElementById('calendarFrame').src = '';
            }
        }

        function setCalendarEmbed(calendarId) {
            const encodedId = encodeURIComponent(calendarId);
            const src = `https://calendar.google.com/calendar/embed?src=${encodedId}&ctz=America/New_York&mode=AGENDA&showTitle=0&showNav=0&showPrint=0&showTabs=0&showCalendars=0&showTz=0`;
            document.getElementById('calendarFrame').src = src;
        }

        function promptCalendarId() {
            const currentId = localStorage.getItem('shins_calendar_id') || '';
            const calendarId = prompt(
                'Enter your Google Calendar ID:\n\n' +
                '(Go to Google Calendar Settings ‚Üí Your calendar ‚Üí Integrate calendar ‚Üí Calendar ID)\n\n' +
                'Example: your.email@gmail.com',
                currentId
            );
            if (calendarId) {
                localStorage.setItem('shins_calendar_id', calendarId);
                setCalendarEmbed(calendarId);
            }
            return false;
        }

        loadCalendar();

        // NYT Top Stories via RSS
        async function loadNews() {
            try {
                const rssUrl = 'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml';
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;

                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.status === 'ok' && data.items) {
                    renderNews(data.items.slice(0, 3));
                } else {
                    throw new Error('Failed to fetch news');
                }
            } catch (e) {
                console.error('News error:', e);
                document.getElementById('newsList').innerHTML =
                    '<div class="news-empty">Unable to load news</div>';
            }
        }

        function renderNews(items) {
            const list = document.getElementById('newsList');

            if (items.length === 0) {
                list.innerHTML = '<div class="news-empty">No news available</div>';
                return;
            }

            list.innerHTML = items.map(item => {
                const thumbnail = item.thumbnail || item.enclosure?.link || '';
                return `
                    <a href="${item.link}" target="_blank" class="news-item">
                        ${thumbnail ? `<img src="${thumbnail}" alt="">` : ''}
                        <div class="news-content">
                            <h4>${item.title}</h4>
                            <p>${item.description?.replace(/<[^>]*>/g, '').substring(0, 150) || ''}</p>
                        </div>
                    </a>
                `;
            }).join('');
        }

        loadNews();
    </script>
</body>
</html>
